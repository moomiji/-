name: Docker

# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

on:
  push:

permissions: write-all

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      OUTPUT_PUBLISH_FAILED: 'echo "failed=true" >> $GITHUB_OUTPUT && echo "::error::Failed to publish packages"'
    steps:

      - name: nuget
        id: nuget
        run: |
          false || eval $OUTPUT_PUBLISH_FAILED
      - name: pip
        id: pip
        run: |
          true || eval $OUTPUT_PUBLISH_FAILED

      - name: This step will still run
        run: echo "This step runs even if the previous step fails."

      - name: Create issue if failed to publish packages
        if: steps.nuget.outputs.failed || steps.pip.outputs.failed
        uses: actions-cool/issues-helper@v3
        with:
          actions: 'create-issue'
          title: 'Failed to publish packages in ${{ needs.meta.outputs.tag }}'
          body: |
            Please manually publish the following packages:
            ${{ steps.nuget.outputs.failed && '- nuget @moomiji' || '' }}
            ${{ steps.pip.outputs.failed && '- pip @QiE2035' || '' }}

